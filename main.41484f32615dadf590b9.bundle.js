!function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=9)}({7:function(e,t,r){},9:function(e,t,r){"use strict";r.r(t);r(7);const n={sequences:Array(8).fill().map((e,t)=>Array(8).fill().map((e,r)=>Array(16).fill().map((e,n)=>n%Math.abs(4-r+t)==0?1:0))),params:Array(8).fill().map(e=>Array(4).fill(.5)),faders:Array(8).fill(0),instrument:0,pattern:0,playing:!1,recording:!1,tempo:101,volume:1,currentStep:-1},s=(e,t,r,n,s)=>(e-t)/r*(s-n)+n,o=(e,t,r)=>e>r?r:e<t?t:e,c=e=>0==e?0:(e=>Math.pow(10,.05*e))(s(1-Math.pow(1-e,2),0,1,-60,0));var a=30,u=240;const i=(e,t)=>{const{type:r,value:n}=t;switch(r){case"tempoDecrease":return e.tempo-=1,e;case"tempoIncrease":return e.tempo+=1,e;case"tempoChange":const t=.05*n;return e.tempo+=t,e.tempo=o(e.tempo,a,u),e;default:return e}},p=(e=>{let t=Object.assign({},e);const r=[],n=[],s=(e={})=>{t=r.reduce((t,r)=>r(t,e),t),n.forEach(e=>e(t)),localStorage.setItem("wr",JSON.stringify(t))};return setTimeout(s,0),{useReducer:(...e)=>r.push(...e),subscribe:e=>n.push(e),dispatch:s,getState:()=>t}})(JSON.parse(window.localStorage.getItem("wr"))||n);p.useReducer((e,t)=>{const{instrument:r,pattern:n}=e,{stepNum:s,currentStep:o}=t;switch(t.type){case"stepToggle":return e.sequences[n][r][s]=e.sequences[n][r][s]?0:1,e;case"setCurrentStep":return e.currentStep=o,e;default:return e}},(e,t)=>{const{type:r,patternNum:n}=t;switch(r){case"patternSelect":return e.pattern=n,e;default:return e}},(e,t)=>{const{type:r,instrumentNum:n}=t;switch(r){case"instrumentSelect":return e.instrument=n,e;default:return e}},(e,t)=>{const{type:r,num:n,value:s}=t;switch(r){case"fadermove":return e.faders[n]=o(e.faders[n]+s,0,1),e;default:return e}},(e,t)=>{const{type:r,value:n,trackNum:s,potNum:c}=t;switch(r){case"potmove":const t=.005*n;return e.params[s][c]=o(e.params[s][c]+t,0,1),e;default:return e}},(e,t)=>{const{type:r}=t;switch(r){case"play":return e.playing=!0,e;case"record":return e.recording=!e.recording,e;case"stop":return e.playing=!1,e.recording=!1,e;case"playstop":return e.playing?(e.playing=!1,e.recording=!1):e.playing=!0,e;default:return e}},i);const l=i({tempo:100},{type:"tempoChange",value:10});console.assert(100.5==l.tempo,l);var d=p;const m=new AudioContext;let f=Promise.all(["kick.wav","snare.wav","ch.wav","oh.wav","clap.wav","cym.wav","tom.wav","cb.wav"].map(e=>new Promise((t,r)=>{const n=new XMLHttpRequest;n.open("GET",`/wr-110/snd/${e}`,!0),n.responseType="arraybuffer",n.onload=()=>{m.decodeAudioData(n.response,e=>t(e),e=>r(e))},n.send()}))).then(e=>f=e);const v=(e=>{let t=0,r=-1,n=-1,o=!0,c=!1,a=0,u=240/a,i=u/16,p={number:-1,buffSources:[]},l=[];const m=[e=>(e=>Math.pow(2,e/12))(s(e,0,1,-24,24)),e=>s(Math.pow(e,3),0,1,.05,5),e=>e,e=>e],v=(e=>Array(8).fill().map((function(){const t=new GainNode(e,{gain:1});t.connect(e.destination);const r=new ConstantSourceNode(e),n=new BiquadFilterNode(e,{type:"lowpass",frequency:5});r.connect(n),n.connect(t.gain);return r.start(),{plug:e=>e.connect(t),setLevel:e=>r.offset.value=e-1}})))(e),y=(e=>Array(32).fill().map((function(){const t=new ConstantSourceNode(e,{offset:0}),r=new BiquadFilterNode(e,{type:"lowpass",frequency:5});t.connect(r),t.start();return{setValue:e=>t.offset.value=e-1,connect:r.connect.bind(r)}})))(e),b=()=>{if(!c)return;requestAnimationFrame(b);const s=e.currentTime,a=(s-t)%u;n=Math.floor(16*a/u)%16;const m=Math.ceil(16*a/u)%16,v=Math.floor((s-t)/u),y=o?0:(0==m?16:m)*i+t+v*u;o=!1,m!=p.number&&(p.number=m,p.buffSources=[],l.forEach((e,t)=>{1==e[m]&&p.buffSources.push(h(f[t],y,t))})),n!=r&&(r=n,d.dispatch({type:"setCurrentStep",currentStep:n}))},h=(t,r,n)=>{const s=new AudioBufferSourceNode(e,{buffer:t});return y[4*n].connect(s.playbackRate),v[n].plug(s),s.start(r),s};return{start:()=>{c||(c=!0,t=e.currentTime,b())},stop:()=>{c=!1,o=!0,n=-1,r=-1,p.buffSources.forEach(e=>e.stop()),p={number:-1,buffSources:[]}},setTempo:e=>{i=(u=240/(a=e))/16},setSequence:e=>l=e,setTrackLevel:(e,t)=>{v[e].setLevel(t)},setParamValue:(e,t)=>{const r=m[e%4];y[e].setValue(r(t))},getCurrentStep:()=>n}})(m);d.subscribe(e=>{e.playing?v.start():v.stop()}),d.subscribe(e=>{v.setSequence(e.sequences[e.pattern])}),d.subscribe(e=>v.setTempo(e.tempo)),d.subscribe(e=>{e.faders.forEach((e,t)=>v.setTrackLevel(t,c(e)))}),d.subscribe(e=>{e.params.forEach((e,t)=>{e.forEach((e,r)=>{v.setParamValue(4*t+r,e)})})}),document.querySelectorAll(".track").forEach((e,t)=>{e.querySelectorAll(".pot").forEach((e,r)=>{e.addEventListener("mousedown",e=>{e.screenX;let n=e.screenY;function s(e){d.dispatch({type:"potmove",value:-(e.screenY-n),trackNum:t,potNum:r}),n=e.screenY}document.addEventListener("mousemove",s),document.addEventListener("mouseup",(function e(){document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",e)}))});const n=e.querySelector(".pot-cursor");d.subscribe(e=>{const o=s(e.params[t][r],0,1,45,315);n.setAttribute("style",`transform: rotate(${o}deg);`)})});const r=e.querySelector(".fader"),n=r.querySelector(".fader-handle"),o=parseFloat(window.getComputedStyle(r).height)-parseFloat(window.getComputedStyle(n).height);r.addEventListener("mousedown",e=>{e.screenX;let r=e.screenY;function n(e){d.dispatch({type:"fadermove",value:-(e.screenY-r)/o,num:t}),r=e.screenY}document.addEventListener("mousemove",n),document.addEventListener("mouseup",(function e(){document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",e)}))}),d.subscribe(e=>{n.setAttribute("style",`top: ${o*(1-e.faders[t])}px;`)});const c=e.querySelector(".select");c.addEventListener("click",e=>{d.dispatch({type:"instrumentSelect",instrumentNum:t})}),d.subscribe(e=>{e.instrument==t?c.classList.add("active"):c.classList.remove("active")})}),document.querySelector("#steps").addEventListener("mousedown",e=>{}),document.querySelectorAll(".step").forEach((e,t)=>{e.addEventListener("mousedown",e=>d.dispatch({type:"stepToggle",stepNum:t})),d.subscribe(r=>{1===r.sequences[r.pattern][r.instrument][t]?e.classList.add("active"):e.classList.remove("active");const n=e.querySelector(".led");r.currentStep==t?n.classList.add("active"):n.classList.remove("active")})}),document.querySelectorAll(".pattern-pad").forEach((e,t)=>{e.addEventListener("mousedown",e=>d.dispatch({type:"patternSelect",patternNum:t})),d.subscribe(r=>{r.pattern==t?e.classList.add("active"):e.classList.remove("active")})}),document.querySelector("#play").addEventListener("click",e=>{d.dispatch({type:"play"})}),document.querySelector("#rec").addEventListener("click",e=>{d.dispatch({type:"record"})}),document.querySelector("#stop").addEventListener("click",e=>{d.dispatch({type:"stop"})}),document.querySelector("#tempo-pot").addEventListener("mousedown",((e="vertical",t=(e=>{}))=>r=>{let n=r.screenX,s=r.screenY;const o=r=>{const o=r.screenX-n,c=r.screenY-s,a="vertical"==e?-c:"horizontal"==e?o:"radial"==e?Math.sqrt(c*c+o*o):0;t(a),s=r.screenY,n=r.screenX},c=()=>{document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",c)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",c)})("vertical",e=>d.dispatch({type:"tempoChange",value:e}))),d.subscribe(e=>{document.querySelector("#tempo-segments").textContent=""+e.tempo.toFixed(0);const t=s(e.tempo,a,u,45,315);document.querySelector("#tempo-pot .pot-cursor").setAttribute("style",`transform: rotate(${t}deg);`)}),document.addEventListener("keydown",e=>{32==e.keyCode&&d.dispatch({type:"playstop"})}),d.subscribe(e=>{e.playing?document.querySelector("#play").classList.add("active"):document.querySelector("#play").classList.remove("active"),e.recording?document.querySelector("#rec").classList.add("active"):document.querySelector("#rec").classList.remove("active")})}});